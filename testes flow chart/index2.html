<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema De Flow Com PlumbJs Com Column</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .menu {
            max-width: 20rem;
            margin-bottom: 1rem;
        }

        .marginClasses-0 {
            margin-left: 1rem;
            /* Ajuste para o menu principal */
        }

        .marginClasses-1 {
            margin-left: 5rem;
        }

        .marginClasses-2 {
            margin-left: 7rem;
        }

        .marginClasses-3 {
            margin-left: 10rem;
        }

        .marginClasses-4 {
            margin-left: 11rem;
        }

        .marginClasses-5 {
            margin-left: 12rem;
        }

        .marginClasses-6 {
            margin-left: 13rem;
        }

        .marginClasses-7 {
            margin-left: 14rem;
        }

        .marginClasses-8 {
            margin-left: 15rem;
        }

        .marginClasses-9 {
            margin-left: 16rem;
        }

        .marginClasses-10 {
            margin-left: 17rem;
        }

        .marginClasses-11 {
            margin-left: 18rem;
        }

        .marginClasses-12 {
            margin-left: 19rem;
        }
    </style>

</head>

<body>
    <div class="container-fluid">
        <div class="row p-3">
            <!-- Linha do Primeiro Menu -->
            <div class="col-12 p-0" id="LinhaMenuPrincipal"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.15.6/js/jsplumb.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="./dados.js"></script>
    <script>
        // Funções para simular o backend enquanto não integra com a página principal
        const getMenuPorId = (codigo) => data.filter(x => x.codigo == codigo)[0];

        // Função para gerar o HTML dos menus em cascata
        const gerarMenuHtml = (menu, nivel = 0) => {
            let marginClass = `marginClasses-${nivel}`;

            let menuHtml = `
                <div class="col-12 p-0 ${marginClass}">
                    <div class="bg-dark p-5 menu" id="Menu${menu.codigo}">
                        <strong class="h6 text-light">${menu.titulo}</strong>
                    </div>
                </div>
            `;

            // Percorre as opções do menu atual
            menu.options.forEach((option) => {
                // Incrementa o nível para as opções
                let optionNivel = nivel + 1;
                let optionMarginClass = `marginClasses-${optionNivel}`;

                menuHtml += `
                <div class="col-12 p-0 ${optionMarginClass}">
                    <div class="bg-dark p-5 menu" id="option${option.codigo}">
                        <strong class="h6 text-light">sou uma option de ${menu.titulo} | ${option.titulo}</strong>
                    </div>
                </div>
                `;

                // Se a opção tiver um submenu, gera o HTML recursivamente
                if (option.tipo === "MensagemDeRespostaInterativa" && option.resposta) {
                    const subMenu = getMenuPorId(parseInt(option.resposta));
                    if (subMenu) {
                        menuHtml += gerarMenuHtml(subMenu, optionNivel);
                    }
                }
            });

            return menuHtml;
        };

        // Inicia com o menu inicial (Menu ID 1)
        const MenuInicial = getMenuPorId(1);
        const menuHtml = gerarMenuHtml(MenuInicial);

        document.querySelector("#LinhaMenuPrincipal").innerHTML = menuHtml;

        // Configuração do jsPlumb
        jsPlumb.ready(function () {

            const conectarMenus = (menu) => {
                menu.options.forEach(option => {
                    jsPlumb.connect({
                        source: `Menu${option.codigoMenu}`,
                        target: `option${option.codigo}`,
                        anchors: ["BottomLeft", "Left"],
                        connector: ["Flowchart"],
                        paintStyle: { stroke: "#000", strokeWidth: 2 },
                        endpoint: "Blank",
                        overlays: [
                            ["Arrow", { width: 12, length: 12, location: 1 }]
                        ]
                    });
                });
            };

            data.forEach(element => {
                conectarMenus(element); 
            });
        });
    </script>


</body>

</html>